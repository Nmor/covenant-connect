{% extends 'base.html' %}

{% block title %}Plan {{ event.title }} - Covenant Connect{% endblock %}

{% block content %}
<h1 class="mb-4">Plan {{ event.title }}</h1>
<form method="post" class="card card-body shadow-sm mb-4">
    <input type='hidden' name='csrf_token' value='{{ csrf_token() }}'>
    <div class="row g-3">
        <div class="col-md-6">
            <label class="form-label" for="recurrence_rule">Recurrence Rule</label>
            <input class="form-control" id="recurrence_rule" name="recurrence_rule" value="{{ event.recurrence_rule or '' }}" placeholder="FREQ=WEEKLY;BYDAY=SU">
        </div>
        <div class="col-md-6">
            <label class="form-label" for="recurrence_end">Recurrence Ends</label>
            <input class="form-control" type="date" id="recurrence_end" name="recurrence_end" value="{{ event.recurrence_end_date.strftime('%Y-%m-%d') if event.recurrence_end_date else '' }}">
        </div>
        <div class="col-12">
            <label class="form-label" for="ministry_tags">Ministry Tags</label>
            <input class="form-control" id="ministry_tags" name="ministry_tags" value="{{ event.ministry_tags | join(', ') }}" placeholder="Worship, Youth">
        </div>
    </div>
    <hr>
    <h2 class="h5">Service Segments</h2>
    <p class="text-muted">Add multiple segments by repeating the fields below.</p>
    <div class="row g-3">
        <div class="col-md-3">
            <label class="form-label">Segment Title</label>
            <input class="form-control" name="segment_title" placeholder="Welcome">
        </div>
        <div class="col-md-3">
            <label class="form-label">Leader</label>
            <input class="form-control" name="segment_leader" placeholder="Leader">
        </div>
        <div class="col-md-2">
            <label class="form-label">Duration</label>
            <input class="form-control" name="segment_duration" placeholder="10 min">
        </div>
        <div class="col-md-4">
            <label class="form-label">Notes</label>
            <input class="form-control" name="segment_notes" placeholder="Key notes">
        </div>
    </div>
    <button type="submit" class="btn btn-primary mt-3">Save Plan</button>
</form>

{% if event.service_segments %}
<h2 class="h5">Current Plan</h2>
<ul class="list-group">
    {% for segment in event.service_segments %}
        <li class="list-group-item">
            <strong>{{ segment.title or 'Segment' }}</strong>
            {% if segment.leader %}<span class="text-muted"> â€” {{ segment.leader }}</span>{% endif %}
            {% if segment.duration %}<div class="small">Duration: {{ segment.duration }}</div>{% endif %}
            {% if segment.notes %}<div class="small text-muted">{{ segment.notes }}</div>{% endif %}
        </li>
    {% endfor %}
</ul>
{% endif %}
{% endblock %}
