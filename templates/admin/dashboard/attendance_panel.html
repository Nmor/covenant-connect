<div class="card h-100">
    <div class="card-header d-flex justify-content-between align-items-center">
        <div>
            <h5 class="card-title mb-0">Attendance Trends</h5>
            <small class="text-muted">Segmented by campus and ministry</small>
        </div>
        <a href="{{ url_for('admin_reports.export_attendance', range=request.args.get('range')) }}" class="btn btn-sm btn-outline-secondary">
            <i class="bi bi-download me-1"></i>Export
        </a>
    </div>
    <div class="card-body">
        <div class="row mb-3 text-center">
            <div class="col-md-4">
                <div class="text-muted">Expected</div>
                <div class="fs-4">{{ attendance.total_expected }}</div>
            </div>
            <div class="col-md-4">
                <div class="text-muted">Checked-In</div>
                <div class="fs-4">{{ attendance.total_checked }}</div>
            </div>
            <div class="col-md-4">
                <div class="text-muted">Attendance Rate</div>
                <div class="fs-4">{{ attendance.attendance_rate }}%</div>
            </div>
        </div>
        {% for campus in attendance.campuses %}
            <div class="mb-4">
                <h6 class="mb-2">{{ campus.campus }} <small class="text-muted">({{ campus.attendance_rate }}%)</small></h6>
                <div class="table-responsive">
                    <table class="table table-sm table-borderless">
                        <thead>
                            <tr class="text-muted">
                                <th>Date</th>
                                <th class="text-end">Checked-In</th>
                                <th class="text-end">Expected</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for entry in campus.timeline %}
                                <tr>
                                    <td>{{ entry.date }}</td>
                                    <td class="text-end">{{ entry.checked }}</td>
                                    <td class="text-end">{{ entry.expected }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% if campus.departments %}
                    <div class="small text-muted">Ministry Detail:</div>
                    <ul class="small">
                        {% for department in campus.departments %}
                            <li>{{ department.name }}: {{ department.checked }} / {{ department.expected }} attendees</li>
                        {% endfor %}
                    </ul>
                {% endif %}
            </div>
        {% else %}
            <p class="text-muted mb-0">No attendance records in this period.</p>
        {% endfor %}
    </div>
</div>
